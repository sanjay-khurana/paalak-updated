$(document).ready(function(a){function b(){a.ajax({method:"GET",url:"/getCartValue/",success:function(b){if(b.success){var c=100*b.cartValue;window.Simpl&&window.Simpl.setTransactionAmount(c),window.Simpl&&window.Simpl.authorizeTransaction(),window.Simpl&&window.Simpl.on("success",function(b){(b.status="success")?q(b.transaction_token):(a("#generic-error").html("Something Went Wrong! Use some other payment method"),a("#generic-error").removeClass("hidden"),window.scrollTo(0,0))})}}})}function c(){a(".prd-rmv-cart").on("click",function(){var b=a(this).parents(".onpage-cart-item").attr("data-prd-id"),c=a(this).parents(".onpage-cart-item").attr("data-prd-variant");i(b,c)})}function d(){a("#generate-otp").attr("disabled",!0),a("#resend_otp").addClass("hidden"),a.ajax({url:"/generateOtp/",data:{contact:a("#contact-no").val()},method:"post",success:function(b){a("#resend_otp").removeClass("hidden"),a("#generate-otp").attr("disabled",!1),a(".generateOtp").addClass("hidden"),a(".verifyOtp").removeClass("hidden")}})}function e(){var b={otp:a("#otp-no").val(),contact:a("#contact-no").val()};a("#verify-otp").attr("disabled",!0),a(".otp-error").addClass("hidden"),a.ajax({url:"/verifyOtp/",data:b,method:"post",success:function(b){a("#verify-otp").attr("disabled",!1),b.success?u?l(!0):window.location.reload():a(".otp-error").removeClass("hidden")}})}function f(b,c){var d=window.location.href.split("#");d[1]&&!c&&(b=a(".nav-tabs").find("."+d[1]).attr("data-category-id")),a(".category_name").removeClass("active"),a(".item-list").addClass("hidden"),a(".category_"+b).removeClass("hidden"),a(".nav-tabs").find(".category_id_"+b).addClass("active")}function g(a){var b={productId:"",price:"",specialPrice:0,image:"",qty:0,name:"",variant:""};b.productId=a.find(".item-name").data("product-id"),b.name=a.find(".item-name").data("product-name"),b.price=a.find(".item-weight").val(),b.qty=1,b.variant=a.find(".item-weight :selected").text(),b.image=a.find(".itemImage").attr("data-src-imageName");var c=r();"object"==typeof c&&c.hasOwnProperty(b.productId+"-"+b.variant)?c[b.productId+"-"+b.variant].qty=parseInt(c[b.productId+"-"+b.variant].qty)+1:c[b.productId+"-"+b.variant]=b,localStorage.setItem("cartJson",JSON.stringify(c)),k()}function h(b,c){var d=JSON.parse(localStorage.getItem("cartJson"));"object"==typeof d&&Object.keys(d).length&&d.hasOwnProperty(b+"-"+c)&&(1==d[b+"-"+c].qty?(delete d[b+"-"+c],a(".product_"+b).find(".product-cnt").val(0)):d[b+"-"+c].qty=parseInt(d[b+"-"+c].qty)-1),localStorage.setItem("cartJson",JSON.stringify(d)),k()}function i(b,c){var d=JSON.parse(localStorage.getItem("cartJson"));"object"==typeof d&&Object.keys(d).length&&d.hasOwnProperty(b+"-"+c)&&(delete d[b+"-"+c],a(".product_"+b).find(".product-cnt").val(0)),localStorage.setItem("cartJson",JSON.stringify(d)),k()}function j(){var b=r(),d="",e="",f=0,g=20;for(var h in b)d=a(".cart-items-temp"),d.find(".prd-name").html(b[h].name),d.find(".prd-qty").html(b[h].qty),d.find(".prd-price").html(b[h].price*b[h].qty),d.find(".prd-variant").html(b[h].variant),d.find(".onpage-cart-item").removeClass("hidden"),d.find(".prd-img").attr("src","/images/"+b[h].image),d.find(".onpage-cart-item").attr("data-prd-id",b[h].productId),d.find(".onpage-cart-item").attr("data-prd-variant",b[h].variant),f+=parseInt(b[h].price*b[h].qty),e+=d.html(),d="";parseInt(f,10)>199&&(g=0),a(".actual-total").html(f),0==f&&(g=0),a(".shipping-charges").html(g),a(".actual-payable").html(f+g),""===e&&(e="Create your basket of fresh produce"),a(".cart-items").html(e),c(),l(!1)}function k(){var b,c,d=r(),e=0;"object"==typeof d&&Object.keys(d).length&&a.each(d,function(d,f){b=f.productId,c=f.variant,productDropdown=a(".product_"+b).find(".item-weight"),productDropdown.val(f.price),a(".product_"+b).find(".product-cnt").val(f.qty),e+=f.qty}),a(".dsk-count > span").html(e),a(".mob-count").html(e),j()}function l(b){var c=r(),d={};if("object"==typeof c&&Object.keys(c).length){var e=0;a.each(c,function(a,b){d[e]={},d[e].productId=b.productId,d[e].variant=b.variant,d[e].qty=b.qty,d[e].price=b.price,d[e].specialPrice=b.specialPrice,d[e].name=b.name,e++})}Object.keys(d).length&&a.ajax({url:"/saveUserCart/",data:d,method:"post",success:function(c){if(1==c.success)if(b)window.location.href="/orderAddress/";else if(c.discount&&c.discount>0){a(".discount-charges").html(c.discount);var d=parseInt(a(".actual-payable").html(),10);a(".actual-payable").html(d-c.discount)}}})}function m(b){a(".wrong-pincode-error").addClass("hidden"),a("#placeorder").attr("disabled",!1);var c={pincode:b};a.ajax({method:"get",url:"/getPincodeDetails/",data:c,success:function(c){0==c.success?(a(".wrong-pincode-error").removeClass("hidden"),a("#placeorder").attr("disabled","disabled")):(a("#city").val(c.city),a("#state").val(c.state),n(b,c.deliveryInfo))}})}function n(b,c){var d="",e=c.availableTimeSlots;for(var f in e)d+='<option value="'+e[f]+'">',d+=e[f]+"</option>";a("#delivery-time").html(d)}function o(b,c){a(".address-screen").hide(),a("#final-delivery-time").html(b);var d=p(c);a("#user-address").html(d),a(".thankyou-screen").removeClass("hidden"),localStorage.removeItem("cartJson")}function p(a){var b=JSON.parse(a),c="";for(var d in b)b[d].length>1&&(c+=b[d]+",");return c}function q(b){a(".error").addClass("hidden");var c=a("#place-order-form");a("#placeOrder").attr("disabled","disabled"),"undefined"!=typeof b&&c.append('<input type="text" class="hidden" name="transaction_token" value="'+b+'" />'),a.ajax({type:c.attr("method"),url:c.attr("action"),data:c.serialize(),success:function(b){if(0==b.success){if(b.errors.length)for(var c in b.errors)a("."+b.errors[c]).removeClass("hidden");a("#placeOrder").attr("disabled",!1)}else b.deliveryTime&&o(b.deliveryTime,b.userAddress)}})}function r(){var b=null!=JSON.parse(localStorage.getItem("cartJson"))?JSON.parse(localStorage.getItem("cartJson")):{};if(Object.keys(b).length)return b;if(a(".cart-json").length>1){var c=JSON.parse(a(".cart-json").html()),d={};return a.each(c,function(a,c){"object"==typeof d&&b.hasOwnProperty(c.productId+"-"+c.variant)?d[c.productId+"-"+c.variant].qty=parseInt(d[c.productId+"-"+c.variant].qty)+1:d[c.productId+"-"+c.variant]=c}),d}return b}function s(){if(a("#address-page").length>0&&window.Simpl&&a("#simpl-checkout").length>0){a("#simpl-checkout").hide();var b=a("#contact").val(),c=a("#email").val();b&&(window.Simpl&&window.Simpl.setApprovalConfig({phone_number:b,email:c}),window.Simpl&&window.Simpl.on("approval",function(){a("#simpl-checkout").show(),a("#simpl-checkout-radio").attr("checked","checked"),window.Simpl&&a("#simpl-checkout-text").html(window.Simpl&&window.Simpl.getDisplayText()).show()},function(){a("#simpl-checkout").hide()}))}}function t(){f(5),k(),s()}var u=(r(),!1);a(".category_name").click(function(){var b=a(this).attr("data-category-id");f(b,!0),a(this).addClass("active")}),a(".add-qty").click(function(){g(a(this).parents(".item-list"))}),a(".sub-qty").click(function(){var b=a(this).parents(".item-list").find(".item-name").data("product-id"),c=a(this).parents(".item-list").find(".item-name").find(".item-weight :selected").text();h(b,c)}),a(".item-weight").change(function(){a(this).parents(".item-list").find(".actual-price").html(a(this).val())}),a(".order-now").click(function(){a(this).data("login-button")?u=!0:l(!0)}),a("#pincode").on("change",function(){6==a(this).val().length&&m(a(this).val())}),a("#pincode").length&&a("#pincode").val().length>0&&m(a("#pincode").val()),a("#placeorder").click(function(){a("#simpl-checkout-radio").is(":checked")?b():q()}),a("#resend_otp").click(function(){return!(a("#contact-no").val().length>10||a("#contact-no").val().length<10)&&void d()}),a("#generate-otp").click(function(){return a(".contact-no-error").addClass("hidden"),a("#contact-no").val().length>10||a("#contact-no").val().length<10?(a(".contact-no-error").removeClass("hidden"),!1):void d()}),a("#verify-otp").click(function(){return a(".otp-error").addClass("hidden"),a("#otp-no").val().length>4||a("#otp-no").val().length<4?(a(".otp-error").removeClass("hidden"),!1):void e()}),t()});